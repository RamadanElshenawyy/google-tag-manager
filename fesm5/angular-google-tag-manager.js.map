{"version":3,"file":"angular-google-tag-manager.js","sources":["ng://angular-google-tag-manager/lib/angular-google-tag-manager.service.ts"],"sourcesContent":["import { Inject, Injectable, Optional } from '@angular/core';\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class GoogleTagManagerService {\n    private isLoaded = false;\n    private gtmId: string;\n    private gtmAuth: string;\n    private gtmPreview: string;\n\n    private browserGlobals = {\n        windowRef(): any {\n            return window;\n        },\n        documentRef(): any {\n            return document;\n        }\n    };\n\n    constructor(\n        @Inject('googleTagManagerId') public googleTagManagerId: string,\n        @Optional() @Inject('googleTagManagerAuth') public googleTagManagerAuth: string,\n        @Optional() @Inject('googleTagManagerPreview') public googleTagManagerPreview: string\n    ) {\n        this.gtmId = googleTagManagerId;\n        this.gtmAuth = googleTagManagerAuth;\n        this.gtmPreview = googleTagManagerPreview;\n    }\n\n    public getDataLayer() {\n        const window = this.browserGlobals.windowRef();\n        window['dataLayer'] = window['dataLayer'] || [];\n        return window['dataLayer'];\n    }\n\n    private pushOnDataLayer(obj: object) {\n        const dataLayer = this.getDataLayer();\n        dataLayer.push(obj);\n    }\n\n    public addGtmToDom() {\n        const doc = this.browserGlobals.documentRef();\n        this.pushOnDataLayer({\n            'gtm.start': new Date().getTime(),\n            event: 'gtm.js'\n        });\n\n        const gtmScript = doc.createElement('script');\n        gtmScript.id = 'GTMscript';\n        gtmScript.async = true;\n        gtmScript.src = this.applyGtmQueryParams(\n            '//www.googletagmanager.com/gtm.js'\n        );\n        doc.head.insertBefore(gtmScript, doc.head.firstChild);\n\n        const ifrm = doc.createElement('iframe');\n        ifrm.setAttribute(\n            'src',\n            this.applyGtmQueryParams('//www.googletagmanager.com/ns.html')\n        );\n        ifrm.style.width = '0';\n        ifrm.style.height = '0';\n        ifrm.style.display = 'none';\n        ifrm.style.visibility = 'hidden';\n\n        const noscript = doc.createElement('noscript');\n        noscript.id = 'GTMiframe';\n        noscript.appendChild(ifrm);\n\n        doc.body.insertBefore(noscript, doc.body.firstChild);\n        this.isLoaded = true;\n    }\n\n    public pushTag(item: object) {\n        if (!this.isLoaded) {\n            this.addGtmToDom();\n        }\n        this.pushOnDataLayer(item);\n    }\n\n    private applyGtmQueryParams(url: string) {\n        const params: string[] = [`id=${this.gtmId}`];\n\n        if (this.gtmAuth) {\n            params.push(`gtm_auth=${this.gtmAuth}`);\n        }\n\n        if (this.gtmPreview) {\n            params.push(`gtm_preview=${this.gtmPreview}`);\n        }\n\n        if (url.indexOf('?') === -1) {\n            url += '?';\n        }\n\n        return url + params.join('&');\n    }\n}\n"],"names":[],"mappings":"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"}