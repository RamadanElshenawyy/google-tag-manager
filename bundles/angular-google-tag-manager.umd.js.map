{"version":3,"file":"angular-google-tag-manager.umd.js","sources":["ng://angular-google-tag-manager/lib/angular-google-tag-manager.service.ts"],"sourcesContent":["import { Inject, Injectable, Optional } from '@angular/core';\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class GoogleTagManagerService {\n    private isLoaded = false;\n    private gtmId: string;\n    private gtmAuth: string;\n    private gtmPreview: string;\n\n    private browserGlobals = {\n        windowRef(): any {\n            return window;\n        },\n        documentRef(): any {\n            return document;\n        }\n    };\n\n    constructor(\n        @Inject('googleTagManagerId') public googleTagManagerId: string,\n        @Optional() @Inject('googleTagManagerAuth') public googleTagManagerAuth: string,\n        @Optional() @Inject('googleTagManagerPreview') public googleTagManagerPreview: string\n    ) {\n        this.gtmId = googleTagManagerId;\n        this.gtmAuth = googleTagManagerAuth;\n        this.gtmPreview = googleTagManagerPreview;\n    }\n\n    public getDataLayer() {\n        const window = this.browserGlobals.windowRef();\n        window['dataLayer'] = window['dataLayer'] || [];\n        return window['dataLayer'];\n    }\n\n    private pushOnDataLayer(obj: object) {\n        const dataLayer = this.getDataLayer();\n        dataLayer.push(obj);\n    }\n\n    public addGtmToDom() {\n        const doc = this.browserGlobals.documentRef();\n        this.pushOnDataLayer({\n            'gtm.start': new Date().getTime(),\n            event: 'gtm.js'\n        });\n\n        const gtmScript = doc.createElement('script');\n        gtmScript.id = 'GTMscript';\n        gtmScript.async = true;\n        gtmScript.src = this.applyGtmQueryParams(\n            '//www.googletagmanager.com/gtm.js'\n        );\n        doc.head.insertBefore(gtmScript, doc.head.firstChild);\n\n        const ifrm = doc.createElement('iframe');\n        ifrm.setAttribute(\n            'src',\n            this.applyGtmQueryParams('//www.googletagmanager.com/ns.html')\n        );\n        ifrm.style.width = '0';\n        ifrm.style.height = '0';\n        ifrm.style.display = 'none';\n        ifrm.style.visibility = 'hidden';\n\n        const noscript = doc.createElement('noscript');\n        noscript.id = 'GTMiframe';\n        noscript.appendChild(ifrm);\n\n        doc.body.insertBefore(noscript, doc.body.firstChild);\n        this.isLoaded = true;\n    }\n\n    public pushTag(item: object) {\n        if (!this.isLoaded) {\n            this.addGtmToDom();\n        }\n        this.pushOnDataLayer(item);\n    }\n\n    private applyGtmQueryParams(url: string) {\n        const params: string[] = [`id=${this.gtmId}`];\n\n        if (this.gtmAuth) {\n            params.push(`gtm_auth=${this.gtmAuth}`);\n        }\n\n        if (this.gtmPreview) {\n            params.push(`gtm_preview=${this.gtmPreview}`);\n        }\n\n        if (url.indexOf('?') === -1) {\n            url += '?';\n        }\n\n        return url + params.join('&');\n    }\n}\n"],"names":["Injectable","Inject","Optional"],"mappings":"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"}