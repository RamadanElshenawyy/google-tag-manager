{"version":3,"sources":["ng://angular-google-tag-manager/lib/angular-google-tag-manager.service.ts"],"names":["GoogleTagManagerService","googleTagManagerId","googleTagManagerAuth","googleTagManagerPreview","this","isLoaded","browserGlobals","windowRef","window","documentRef","document","gtmId","gtmAuth","gtmPreview","prototype","getDataLayer","pushOnDataLayer","obj","push","addGtmToDom","doc","gtm.start","Date","getTime","event","gtmScript","createElement","id","async","src","applyGtmQueryParams","head","insertBefore","firstChild","ifrm","setAttribute","style","width","height","display","visibility","noscript","appendChild","body","pushTag","item","url","params","indexOf","join","Injectable","args","providedIn","Inject","Optional","type"],"mappings":"6SAAA,IAAAA,EAAA,WAoBI,SAAAA,EACyCC,EACcC,EACGC,GAFjBC,KAAAH,mBAAAA,EACcG,KAAAF,qBAAAA,EACGE,KAAAD,wBAAAA,EAjBlDC,KAAAC,UAAW,EAKXD,KAAAE,eAAiB,CACrBC,UAAA,WACI,OAAOC,QAEXC,YAAA,WACI,OAAOC,WASXN,KAAKO,MAAQV,EACbG,KAAKQ,QAAUV,EACfE,KAAKS,WAAaV,SAGfH,EAAAc,UAAAC,aAAP,eACUP,EAASJ,KAAKE,eAAeC,YAEnC,OADAC,EAAkB,UAAIA,EAAkB,WAAK,GACtCA,EAAkB,WAGrBR,EAAAc,UAAAE,gBAAR,SAAwBC,GACFb,KAAKW,eACbG,KAAKD,IAGZjB,EAAAc,UAAAK,YAAP,eACUC,EAAMhB,KAAKE,eAAeG,cAChCL,KAAKY,gBAAgB,CACjBK,aAAa,IAAIC,MAAOC,UACxBC,MAAO,eAGLC,EAAYL,EAAIM,cAAc,UACpCD,EAAUE,GAAK,YACfF,EAAUG,OAAQ,EAClBH,EAAUI,IAAMzB,KAAK0B,oBACjB,qCAEJV,EAAIW,KAAKC,aAAaP,EAAWL,EAAIW,KAAKE,gBAEpCC,EAAOd,EAAIM,cAAc,UAC/BQ,EAAKC,aACD,MACA/B,KAAK0B,oBAAoB,uCAE7BI,EAAKE,MAAMC,MAAQ,IACnBH,EAAKE,MAAME,OAAS,IACpBJ,EAAKE,MAAMG,QAAU,OACrBL,EAAKE,MAAMI,WAAa,aAElBC,EAAWrB,EAAIM,cAAc,YACnCe,EAASd,GAAK,YACdc,EAASC,YAAYR,GAErBd,EAAIuB,KAAKX,aAAaS,EAAUrB,EAAIuB,KAAKV,YACzC7B,KAAKC,UAAW,GAGbL,EAAAc,UAAA8B,QAAP,SAAeC,GACNzC,KAAKC,UACND,KAAKe,cAETf,KAAKY,gBAAgB6B,IAGjB7C,EAAAc,UAAAgB,oBAAR,SAA4BgB,OAClBC,EAAmB,CAAC,MAAM3C,KAAKO,OAcrC,OAZIP,KAAKQ,SACLmC,EAAO7B,KAAK,YAAYd,KAAKQ,SAG7BR,KAAKS,YACLkC,EAAO7B,KAAK,eAAed,KAAKS,aAGV,IAAtBiC,EAAIE,QAAQ,OACZF,GAAO,KAGJA,EAAMC,EAAOE,KAAK,0BA9FhCC,EAAAA,WAAUC,KAAA,CAAC,CACRC,WAAY,6EAkBPC,EAAAA,OAAMF,KAAA,CAAC,wDACPG,EAAAA,UAAQ,CAAAC,KAAIF,EAAAA,OAAMF,KAAA,CAAC,0DACnBG,EAAAA,UAAQ,CAAAC,KAAIF,EAAAA,OAAMF,KAAA,CAAC,sPAvB5B","sourcesContent":["import { Inject, Injectable, Optional } from '@angular/core';\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class GoogleTagManagerService {\n    private isLoaded = false;\n    private gtmId: string;\n    private gtmAuth: string;\n    private gtmPreview: string;\n\n    private browserGlobals = {\n        windowRef(): any {\n            return window;\n        },\n        documentRef(): any {\n            return document;\n        }\n    };\n\n    constructor(\n        @Inject('googleTagManagerId') public googleTagManagerId: string,\n        @Optional() @Inject('googleTagManagerAuth') public googleTagManagerAuth: string,\n        @Optional() @Inject('googleTagManagerPreview') public googleTagManagerPreview: string\n    ) {\n        this.gtmId = googleTagManagerId;\n        this.gtmAuth = googleTagManagerAuth;\n        this.gtmPreview = googleTagManagerPreview;\n    }\n\n    public getDataLayer() {\n        const window = this.browserGlobals.windowRef();\n        window['dataLayer'] = window['dataLayer'] || [];\n        return window['dataLayer'];\n    }\n\n    private pushOnDataLayer(obj: object) {\n        const dataLayer = this.getDataLayer();\n        dataLayer.push(obj);\n    }\n\n    public addGtmToDom() {\n        const doc = this.browserGlobals.documentRef();\n        this.pushOnDataLayer({\n            'gtm.start': new Date().getTime(),\n            event: 'gtm.js'\n        });\n\n        const gtmScript = doc.createElement('script');\n        gtmScript.id = 'GTMscript';\n        gtmScript.async = true;\n        gtmScript.src = this.applyGtmQueryParams(\n            '//www.googletagmanager.com/gtm.js'\n        );\n        doc.head.insertBefore(gtmScript, doc.head.firstChild);\n\n        const ifrm = doc.createElement('iframe');\n        ifrm.setAttribute(\n            'src',\n            this.applyGtmQueryParams('//www.googletagmanager.com/ns.html')\n        );\n        ifrm.style.width = '0';\n        ifrm.style.height = '0';\n        ifrm.style.display = 'none';\n        ifrm.style.visibility = 'hidden';\n\n        const noscript = doc.createElement('noscript');\n        noscript.id = 'GTMiframe';\n        noscript.appendChild(ifrm);\n\n        doc.body.insertBefore(noscript, doc.body.firstChild);\n        this.isLoaded = true;\n    }\n\n    public pushTag(item: object) {\n        if (!this.isLoaded) {\n            this.addGtmToDom();\n        }\n        this.pushOnDataLayer(item);\n    }\n\n    private applyGtmQueryParams(url: string) {\n        const params: string[] = [`id=${this.gtmId}`];\n\n        if (this.gtmAuth) {\n            params.push(`gtm_auth=${this.gtmAuth}`);\n        }\n\n        if (this.gtmPreview) {\n            params.push(`gtm_preview=${this.gtmPreview}`);\n        }\n\n        if (url.indexOf('?') === -1) {\n            url += '?';\n        }\n\n        return url + params.join('&');\n    }\n}\n"]}